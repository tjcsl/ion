<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>intranet.settings &#8212; TJ Intranet v3 (Build #1306) documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          TJ Intranet</a>
        <span class="navbar-text navbar-version pull-left"><b>v3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Topics <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup/index.html">Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../setup/server.html">Setting up the Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/index.html">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/index.html#technologies">Technologies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developing/index.html">Developing for Intranet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developing/eighth-models.html">Understanding the Eighth models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/howto.html">How to do Ion development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/oauth.html">Using OAuth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/requirements.html">Ion Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/styleguide.html">Coding Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/testing.html">Testing Ion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developing/updates.html">Keeping things up-to-date</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../sourcedoc/modules.html">intranet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../sourcedoc/intranet.html">intranet package</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Section <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for intranet.settings</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>  <span class="c1"># noqa</span>

<span class="kn">import</span> <span class="nn">celery.schedules</span>
<span class="kn">import</span> <span class="nn">sentry_sdk</span>
<span class="kn">from</span> <span class="nn">sentry_sdk.integrations.celery</span> <span class="kn">import</span> <span class="n">CeleryIntegration</span>
<span class="kn">from</span> <span class="nn">sentry_sdk.integrations.django</span> <span class="kn">import</span> <span class="n">DjangoIntegration</span>
<span class="kn">from</span> <span class="nn">sentry_sdk.integrations.logging</span> <span class="kn">import</span> <span class="n">LoggingIntegration</span>

<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">helpers</span>  <span class="c1"># pylint: disable=wrong-import-position # noqa</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="c1"># Require Python 3.5+</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Python 3.5 or higher is required.&quot;</span><span class="p">)</span>

<span class="c1"># Month (1-indexed) after which a new school year begins</span>
<span class="c1"># July = 7</span>
<span class="n">YEAR_TURNOVER_MONTH</span> <span class="o">=</span> <span class="mi">7</span>

<span class="n">start_school_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="n">YEAR_TURNOVER_MONTH</span> <span class="k">else</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
<span class="n">end_school_year</span> <span class="o">=</span> <span class="n">start_school_year</span> <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="n">YEAR_TURNOVER_MONTH</span> <span class="k">else</span> <span class="n">start_school_year</span> <span class="o">+</span> <span class="mi">1</span>


<span class="sd">&quot;&quot;&quot; !! -------- UPDATE ANNUALLY -------- !!</span>
<span class="sd">Update this section annually after summer school ends and before school starts.</span>
<span class="sd">Last updated: 2022-08-30. &quot;&quot;&quot;</span>

<span class="c1"># When school is scheduled to start and end</span>
<span class="n">SCHOOL_START_DATE</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">start_school_year</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
<span class="n">SCHOOL_END_DATE</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">end_school_year</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="c1"># Dates when hoco starts and ends</span>
<span class="n">HOCO_START_DATE</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">start_school_year</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
<span class="n">HOCO_END_DATE</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">start_school_year</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;  -------- END UPDATE ANNUALLY --------  &quot;&quot;&quot;</span>

<span class="c1"># Default fallback time for start and end of school if no schedule is available</span>
<span class="n">SCHOOL_START_HOUR</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Not currently used</span>
<span class="n">SCHOOL_START_MINUTE</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># Not currently used</span>
<span class="n">SCHOOL_END_HOUR</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">SCHOOL_END_MINUTE</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Adjust for summer school:</span>
<span class="n">IS_SUMMER_SCHOOL</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">SCHOOL_START_DATE</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">IS_SUMMER_SCHOOL</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">SCHOOL_START_HOUR</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">SCHOOL_START_MINUTE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SCHOOL_END_HOUR</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">SCHOOL_END_MINUTE</span> <span class="o">=</span> <span class="mi">0</span>

<span class="sd">&quot;&quot;&quot; !! In production, add a file called secret.py to the settings package that</span>
<span class="sd">defines SECRET_KEY, SECRET_DATABASE_URL. !!</span>


<span class="sd">SECRET_DATABASE_URL should be of the following form:</span>
<span class="sd">    postgres://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;/&lt;database&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Dummy values for development and testing.</span>
<span class="c1"># Overridden by the import from secret.py below.</span>
<span class="n">SECRET_DATABASE_URL</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: str</span>
<span class="n">MAINTENANCE_MODE</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: bool</span>
<span class="n">TJSTAR_MAP</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: bool</span>
<span class="n">TWITTER_KEYS</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Dict[str,str]</span>
<span class="n">SENTRY_PUBLIC_DSN</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: str</span>
<span class="n">USE_SASL</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">NO_CACHE</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">PARKING_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">PARKING_MAX_ABSENCES</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">NOMINATIONS_ACTIVE</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">NOMINATION_POSITION</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">ENABLE_WAITLIST</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># WARNING: Enabling the waitlist causes severe performance issues</span>
<span class="n">ENABLE_BUS_APP</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">ENABLE_BUS_DRIVER</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">ENABLE_PRE_EIGHTH_CLOSE_SIGNUP_REDIRECT</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Redirect to eighth signup page after login if the user isn&#39;t signed up for activities</span>
<span class="n">ENABLE_PRE_EIGHTH_LOCATION_REDIRECT</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Redirect to eighth_location around eighth period (increase performance during peak times)</span>
<span class="n">ENABLE_PRE_DISMISSAL_BUS_REDIRECT</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Redirect to bus page around dismissal</span>
<span class="n">NOTIFY_ADMIN_EMAILS</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">IOS_APP_CLIENT_IDS</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Attempting to OAuth to an application with one of these client IDs will result in a *special* error message</span>
<span class="c1"># See templates/oauth2_provider/authorize.html</span>

<span class="n">ALLOWED_METRIC_SCRAPE_IPS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">EMERGENCY_MESSAGE</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: str</span>

<span class="c1"># Hosts/domain names that are valid for this site; required if DEBUG is False</span>
<span class="c1"># See https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts</span>
<span class="c1">#</span>
<span class="c1"># In production, Nginx filters requests that are not in this list. If this is</span>
<span class="c1"># not done, a notification gets sent whenever someone messes with</span>
<span class="c1"># the HTTP Host header.</span>
<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ion.tjhsst.edu&quot;</span><span class="p">,</span> <span class="s2">&quot;198.38.18.250&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">]</span>

<span class="n">PRODUCTION</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PRODUCTION&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span>
<span class="n">IN_CI</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TRAVIS&quot;</span><span class="p">,</span> <span class="s2">&quot;GITHUB_ACTIONS&quot;</span><span class="p">])</span>
<span class="c1"># FIXME: figure out a less-hacky way to do this.</span>
<span class="n">TESTING</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;test&quot;</span> <span class="ow">in</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
<span class="n">LOGGING_VERBOSE</span> <span class="o">=</span> <span class="n">PRODUCTION</span>

<span class="c1"># Whether to report master password attempts</span>
<span class="n">MASTER_NOTIFY</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># DEBUG defaults to off in PRODUCTION, on otherwise.</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="ow">not</span> <span class="n">PRODUCTION</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span>

<span class="c1"># Don&#39;t send emails unless we&#39;re in production.</span>
<span class="n">EMAIL_ANNOUNCEMENTS</span> <span class="o">=</span> <span class="n">PRODUCTION</span>
<span class="n">SEND_ANNOUNCEMENT_APPROVAL</span> <span class="o">=</span> <span class="n">PRODUCTION</span>

<span class="c1"># Whether to force sending emails, even if we aren&#39;t in production.</span>
<span class="n">FORCE_EMAIL_SEND</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Don&#39;t require https for testing.</span>
<span class="n">SESSION_COOKIE_SECURE</span> <span class="o">=</span> <span class="n">PRODUCTION</span>
<span class="n">CSRF_COOKIE_SECURE</span> <span class="o">=</span> <span class="n">PRODUCTION</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">PRODUCTION</span><span class="p">:</span>
    <span class="c1"># We don&#39;t care about session security when running a testing instance.</span>
    <span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s2">&quot;_5kc##e7(!4=4)h4slxlgm010l+43zd_84g@82771ay6no-1&amp;i&quot;</span>
    <span class="c1"># Trust X-Forwarded-For when testing</span>
    <span class="n">SECURE_PROXY_SSL_HEADER</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;HTTP_X_FORWARDED_PROTOCOL&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">)</span>

<span class="c1"># Internal IP ranges in production</span>
<span class="n">_internal_ip_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;198.38.16.0/20&quot;</span><span class="p">,</span> <span class="s2">&quot;2001:468:cc0::/48&quot;</span><span class="p">]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">PRODUCTION</span><span class="p">:</span>
    <span class="c1"># Additional Internal IP ranges for debugging</span>
    <span class="n">_internal_ip_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;127.0.0.0/8&quot;</span><span class="p">,</span> <span class="s2">&quot;10.0.0.0/8&quot;</span><span class="p">])</span>

<span class="n">INTERNAL_IPS</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">GlobList</span><span class="p">(</span><span class="n">_internal_ip_list</span><span class="p">)</span>

<span class="c1"># Used for Printing access; FCPS external/internal IP ranges</span>
<span class="n">_tj_ip_list</span> <span class="o">=</span> <span class="n">_internal_ip_list</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;151.188.0.0/18&quot;</span><span class="p">,</span> <span class="s2">&quot;151.188.192.0/18&quot;</span><span class="p">,</span> <span class="s2">&quot;10.0.0.0/8&quot;</span><span class="p">]</span>

<span class="n">TJ_IPS</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">GlobList</span><span class="p">(</span><span class="n">_tj_ip_list</span><span class="p">)</span>

<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="c1"># What login_required decorator redirects to</span>
<span class="c1"># https://docs.djangoproject.com/en/dev/ref/settings/#login-url</span>
<span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s2">&quot;/login&quot;</span>
<span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>

<span class="c1"># Whether to perform an HTTP redirect to append a slash</span>
<span class="n">APPEND_SLASH</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Email notifications backend and mailserver configuration</span>
<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s2">&quot;django.core.mail.backends.smtp.EmailBackend&quot;</span>
<span class="n">EMAIL_HOST</span> <span class="o">=</span> <span class="s2">&quot;mail.tjhsst.edu&quot;</span>
<span class="n">EMAIL_PORT</span> <span class="o">=</span> <span class="mi">587</span>
<span class="n">EMAIL_USE_TLS</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">EMAIL_SUBJECT_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;[Ion] &quot;</span>
<span class="n">EMAIL_ANNOUNCEMENTS</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Address to send messages from</span>
<span class="n">EMAIL_FROM</span> <span class="o">=</span> <span class="s2">&quot;ion-noreply@tjhsst.edu&quot;</span>

<span class="c1"># Use PostgreSQL database</span>
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ENGINE&quot;</span><span class="p">:</span> <span class="s2">&quot;django_prometheus.db.backends.postgresql&quot;</span><span class="p">,</span> <span class="s2">&quot;CONN_MAX_AGE&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}}</span>  <span class="c1"># type: Dict[str,Dict[str,Any]]</span>

<span class="c1"># Address to send feedback messages to</span>
<span class="n">FEEDBACK_EMAIL</span> <span class="o">=</span> <span class="s2">&quot;intranet@tjhsst.edu&quot;</span>

<span class="c1"># Address to send approval messages to</span>
<span class="n">APPROVAL_EMAIL</span> <span class="o">=</span> <span class="s2">&quot;intranet-approval@tjhsst.edu&quot;</span>

<span class="n">FILE_UPLOAD_HANDLERS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;django.core.files.uploadhandler.MemoryFileUploadHandler&quot;</span><span class="p">,</span> <span class="s2">&quot;django.core.files.uploadhandler.TemporaryFileUploadHandler&quot;</span><span class="p">]</span>

<span class="c1"># The maximum number of pages in one document that can be</span>
<span class="c1"># printed through the printing functionality (determined through pdfinfo)</span>
<span class="n">PRINTING_PAGES_LIMIT</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c1"># The maximum file upload and download size for files</span>
<span class="n">FILES_MAX_UPLOAD_SIZE</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
<span class="n">FILES_MAX_DOWNLOAD_SIZE</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>

<span class="n">DATA_UPLOAD_MAX_MEMORY_SIZE</span> <span class="o">=</span> <span class="n">FILES_MAX_UPLOAD_SIZE</span>

<span class="c1"># Custom error view for CSRF errors; if unspecified, caught by nginx with a generic error</span>
<span class="n">CSRF_FAILURE_VIEW</span> <span class="o">=</span> <span class="s2">&quot;intranet.apps.error.views.handle_csrf_view&quot;</span>

<span class="c1">############################################</span>
<span class="c1">#    OPSEC: GIVE A REASON FOR SILENCING    #</span>
<span class="c1">#    SYSTEM CHECKS IF YOU ADD ONE HERE!    #</span>
<span class="c1">############################################</span>

<span class="n">SILENCED_SYSTEM_CHECKS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># W001 doesn&#39;t apply, as we use nginx to handle SecurityMiddleware&#39;s functions.</span>
    <span class="s2">&quot;security.W001&quot;</span><span class="p">,</span>
    <span class="c1"># Suppress W019, as we use frames in the signage module.</span>
    <span class="s2">&quot;security.W019&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Local time zone for this installation. Choices can be found here:</span>
<span class="c1"># http://en.wikipedia.org/wiki/List_of_tz_zones_by_name</span>
<span class="c1"># although not all choices may be available on all operating systems.</span>
<span class="c1"># In a Windows environment this must be set to your system time zone.</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s2">&quot;America/New_York&quot;</span>

<span class="c1"># Language code for this installation. All choices can be found here:</span>
<span class="c1"># http://www.i18nguy.com/unicode/language-identifiers.html</span>
<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s2">&quot;en-us&quot;</span>

<span class="n">SITE_ID</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># If you set this to False, Django will make some optimizations so as not</span>
<span class="c1"># to load the internationalization machinery.</span>
<span class="n">USE_I18N</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># If you set this to False, Django will not format dates, numbers and</span>
<span class="c1"># calendars according to the current locale.</span>
<span class="n">USE_L10N</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># If you set this to False, Django will not use timezone-aware datetimes.</span>
<span class="n">USE_TZ</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Absolute filesystem path to the directory that will hold user-uploaded files.</span>
<span class="c1"># Example: &quot;/home/media/media.lawrence.com/media/&quot;</span>
<span class="c1">#</span>
<span class="c1"># Not used.</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">),</span> <span class="s2">&quot;uploads&quot;</span><span class="p">)</span>

<span class="c1"># URL that handles the media served from MEDIA_ROOT. Make sure to use a</span>
<span class="c1"># trailing slash.</span>
<span class="c1"># Examples: &quot;http://media.lawrence.com/media/&quot;, &quot;http://example.com/media/&quot;</span>
<span class="c1">#</span>
<span class="c1"># Not used.</span>
<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">TEST_RUNNER</span> <span class="o">=</span> <span class="s2">&quot;django.test.runner.DiscoverRunner&quot;</span>

<span class="c1"># Absolute path to the directory static files should be collected to.</span>
<span class="c1"># Don&quot;t put anything in this directory yourself; store your static files</span>
<span class="c1"># in apps&quot; &quot;static/&quot; subdirectories and in STATICFILES_DIRS.</span>
<span class="c1"># Example: &quot;/home/media/media.lawrence.com/static/&quot;</span>
<span class="c1">#</span>
<span class="c1"># This is the folder that Nginx serves as /static in production</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">,</span> <span class="s2">&quot;collected_static&quot;</span><span class="p">)</span>

<span class="c1"># URL prefix for static files.</span>
<span class="c1"># Example: &quot;http://media.lawrence.com/static/&quot;</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s2">&quot;/static/&quot;</span>

<span class="c1"># Additional locations of static files</span>
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Put strings here, like &quot;/home/html/static&quot; or &quot;C:/www/django/static&quot;.</span>
    <span class="c1"># Always use forward slashes, even on Windows.</span>
    <span class="c1"># Don&quot;t forget to use absolute paths, not relative paths.</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">,</span> <span class="s2">&quot;static&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># List of finder classes that know how to find static files in</span>
<span class="c1"># various locations.</span>
<span class="n">STATICFILES_FINDERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.staticfiles.finders.FileSystemFinder&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.staticfiles.finders.AppDirectoriesFinder&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pipeline.finders.PipelineFinder&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">STATICFILES_STORAGE</span> <span class="o">=</span> <span class="s2">&quot;pipeline.storage.PipelineStorage&quot;</span>

<span class="n">PIPELINE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CSS_COMPRESSOR&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;COMPILERS&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pipeline.compilers.sass.SASSCompiler&quot;</span><span class="p">],</span>
    <span class="s2">&quot;STYLESHEETS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;source_filenames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;css/base.scss&quot;</span><span class="p">,</span> <span class="s2">&quot;css/themes.scss&quot;</span><span class="p">,</span> <span class="s2">&quot;css/responsive.scss&quot;</span><span class="p">],</span>
            <span class="s2">&quot;output_filename&quot;</span><span class="p">:</span> <span class="s2">&quot;css/base.css&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;eighth.admin&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;source_filenames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;css/eighth.common.scss&quot;</span><span class="p">,</span> <span class="s2">&quot;css/eighth.admin.scss&quot;</span><span class="p">],</span>
            <span class="s2">&quot;output_filename&quot;</span><span class="p">:</span> <span class="s2">&quot;css/eighth.admin.css&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;eighth.signup&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;source_filenames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;css/eighth.common.scss&quot;</span><span class="p">,</span> <span class="s2">&quot;css/eighth.signup.scss&quot;</span><span class="p">],</span>
            <span class="s2">&quot;output_filename&quot;</span><span class="p">:</span> <span class="s2">&quot;css/eighth.signup.css&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>  <span class="c1"># type: Dict[str,Any]</span>

<span class="n">LIST_OF_INDEPENDENT_CSS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;about&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api&quot;</span><span class="p">,</span>
    <span class="s2">&quot;login&quot;</span><span class="p">,</span>
    <span class="s2">&quot;emerg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;files&quot;</span><span class="p">,</span>
    <span class="s2">&quot;schedule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;theme.blue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;page_base&quot;</span><span class="p">,</span>
    <span class="s2">&quot;responsive.core&quot;</span><span class="p">,</span>
    <span class="s2">&quot;search&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dashboard&quot;</span><span class="p">,</span>
    <span class="s2">&quot;events&quot;</span><span class="p">,</span>
    <span class="s2">&quot;schedule.widget&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dashboard.widgets&quot;</span><span class="p">,</span>
    <span class="s2">&quot;profile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;polls&quot;</span><span class="p">,</span>
    <span class="s2">&quot;groups&quot;</span><span class="p">,</span>
    <span class="s2">&quot;board&quot;</span><span class="p">,</span>
    <span class="s2">&quot;announcements.form&quot;</span><span class="p">,</span>
    <span class="s2">&quot;polls.form&quot;</span><span class="p">,</span>
    <span class="s2">&quot;preferences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;signage.base&quot;</span><span class="p">,</span>
    <span class="s2">&quot;signage.touch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;signage.touch.landscape&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eighth.common&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eighth.attendance&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eighth.profile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eighth.schedule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eighth.maintenance&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lostfound&quot;</span><span class="p">,</span>
    <span class="s2">&quot;welcome&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hoco_ribbon&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hoco_scores&quot;</span><span class="p">,</span>
    <span class="s2">&quot;oauth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;signage.page&quot;</span><span class="p">,</span>
    <span class="s2">&quot;courses&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sessionmgmt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/base&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/login&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/schedule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/events&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/dashboard&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/dashboard.widgets&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/schedule.widget&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/nav&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/cke&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/polls&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/bus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/files&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/welcome&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/preferences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/about&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/lostfound&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/eighth.signup&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/eighth.attendance&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/select&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/eighth.schedule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/oauth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dark/sessionmgmt&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">LIST_OF_INDEPENDENT_CSS</span><span class="p">:</span>
    <span class="n">PIPELINE</span><span class="p">[</span><span class="s2">&quot;STYLESHEETS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">helpers</span><span class="o">.</span><span class="n">single_css_map</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

<span class="n">AUTHENTICATION_BACKENDS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;django.contrib.auth.backends.ModelBackend&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.auth.backends.MasterPasswordAuthenticationBackend&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.auth.backends.KerberosAuthenticationBackend&quot;</span><span class="p">,</span>
    <span class="s2">&quot;oauth2_provider.backends.OAuth2Backend&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Default to Argon2, see https://docs.djangoproject.com/en/dev/topics/auth/passwords/#argon2-usage</span>
<span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.auth.hashers.Argon2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptSHA256PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptPasswordHasher&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Use the custom User model defined in apps/users/models.py</span>
<span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s2">&quot;users.User&quot;</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;django.template.backends.django.DjangoTemplates&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DIRS&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">,</span> <span class="s2">&quot;templates&quot;</span><span class="p">),),</span>
        <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;context_processors&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s2">&quot;django.contrib.auth.context_processors.auth&quot;</span><span class="p">,</span>  <span class="c1"># Authentication; must be defined first</span>
                <span class="s2">&quot;django.template.context_processors.debug&quot;</span><span class="p">,</span>  <span class="c1"># Django default</span>
                <span class="s2">&quot;django.template.context_processors.request&quot;</span><span class="p">,</span>  <span class="c1"># Django default</span>
                <span class="s2">&quot;django.contrib.messages.context_processors.messages&quot;</span><span class="p">,</span>  <span class="c1"># For page messages</span>
                <span class="s2">&quot;intranet.apps.context_processors.ion_base_url&quot;</span><span class="p">,</span>  <span class="c1"># For determining the base url</span>
                <span class="s2">&quot;intranet.apps.context_processors.nav_categorizer&quot;</span><span class="p">,</span>  <span class="c1"># For determining the category in the navbar</span>
                <span class="s2">&quot;intranet.apps.context_processors.csl_apps&quot;</span><span class="p">,</span>  <span class="c1"># For showing a list of CSL apps in the navbar</span>
                <span class="s2">&quot;intranet.apps.context_processors.global_warning&quot;</span><span class="p">,</span>  <span class="c1"># For showing a global warning throughout the application (in page_base.html)</span>
                <span class="s2">&quot;intranet.apps.eighth.context_processors.start_date&quot;</span><span class="p">,</span>  <span class="c1"># For determining the eighth pd start date</span>
                <span class="s2">&quot;intranet.apps.eighth.context_processors.absence_count&quot;</span><span class="p">,</span>  <span class="c1"># For showing the absence count in the navbar</span>
                <span class="s2">&quot;intranet.apps.eighth.context_processors.enable_waitlist&quot;</span><span class="p">,</span>  <span class="c1"># For checking if the waitlist is enabled</span>
                <span class="s2">&quot;intranet.apps.context_processors.mobile_app&quot;</span><span class="p">,</span>  <span class="c1"># For the custom android app functionality (tbd?)</span>
                <span class="s2">&quot;intranet.apps.context_processors.is_tj_ip&quot;</span><span class="p">,</span>  <span class="c1"># Whether on the internal TJ or FCPS network</span>
                <span class="s2">&quot;intranet.apps.context_processors.show_homecoming&quot;</span><span class="p">,</span>  <span class="c1"># Sitewide custom themes (special events, etc)</span>
                <span class="s2">&quot;intranet.apps.context_processors.global_custom_theme&quot;</span><span class="p">,</span>  <span class="c1"># Sitewide custom themes (special events, etc)</span>
                <span class="s2">&quot;intranet.apps.context_processors.show_bus_button&quot;</span><span class="p">,</span>
                <span class="s2">&quot;intranet.apps.context_processors.enable_dark_mode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;intranet.apps.context_processors.oauth_toolkit&quot;</span><span class="p">,</span>  <span class="c1"># Django OAuth Toolkit-related middleware</span>
                <span class="s2">&quot;intranet.apps.context_processors.settings_export&quot;</span><span class="p">,</span>  <span class="c1"># &quot;Exports&quot; django.conf.settings as DJANGO_SETTINGS</span>
                <span class="s2">&quot;intranet.apps.features.context_processors.feature_announcements&quot;</span><span class="p">,</span>  <span class="c1"># Feature announcements that need to be shown on the current page</span>
            <span class="p">),</span>
            <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Only enabled if DEBUG is true as well</span>
            <span class="s2">&quot;loaders&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;django.template.loaders.filesystem.Loader&quot;</span><span class="p">,</span> <span class="s2">&quot;django.template.loaders.app_directories.Loader&quot;</span><span class="p">),</span>
            <span class="s2">&quot;libraries&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;staticfiles&quot;</span><span class="p">:</span> <span class="s2">&quot;django.templatetags.static&quot;</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">]</span>  <span class="c1"># type: List[Dict[str,Any]]</span>

<span class="k">if</span> <span class="n">PRODUCTION</span><span class="p">:</span>
    <span class="n">TEMPLATES</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;OPTIONS&quot;</span><span class="p">][</span><span class="s2">&quot;loaders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;django.template.loaders.cached.Loader&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;django.template.loaders.filesystem.Loader&quot;</span><span class="p">,</span> <span class="s2">&quot;django.template.loaders.app_directories.Loader&quot;</span><span class="p">])</span>
    <span class="p">]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">PRODUCTION</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;WARN_INVALID_TEMPLATE_VARS&quot;</span><span class="p">,</span> <span class="s2">&quot;NO&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
    <span class="n">TEMPLATES</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;OPTIONS&quot;</span><span class="p">][</span><span class="s2">&quot;string_if_invalid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">InvalidString</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;intranet.middleware.url_slashes.FixSlashes&quot;</span><span class="p">,</span>  <span class="c1"># Remove slashes in URLs</span>
    <span class="s2">&quot;intranet.middleware.same_origin.SameOriginMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># 401s requests with an &quot;Origin&quot; header that doesn&#39;t match the &quot;Host&quot; header</span>
    <span class="s2">&quot;django_prometheus.middleware.PrometheusBeforeMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Django Prometheus initial</span>
    <span class="s2">&quot;django.middleware.common.CommonMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Django default</span>
    <span class="s2">&quot;django.contrib.sessions.middleware.SessionMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Django sessions</span>
    <span class="s2">&quot;django.middleware.csrf.CsrfViewMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Django CSRF</span>
    <span class="s2">&quot;django.middleware.clickjacking.XFrameOptionsMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Django X-Frame-Options</span>
    <span class="s2">&quot;django.contrib.auth.middleware.AuthenticationMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Django auth</span>
    <span class="s2">&quot;oauth2_provider.middleware.OAuth2TokenMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Django Oauth toolkit</span>
    <span class="s2">&quot;intranet.middleware.monitoring.PrometheusAccessMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Restricts access to Django Prometheus metrics to ALLOWED_METRIC_IPS and superusers</span>
    <span class="s2">&quot;maintenance_mode.middleware.MaintenanceModeMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Maintenance mode</span>
    <span class="s2">&quot;intranet.middleware.threadlocals.ThreadLocalsMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Thread locals</span>
    <span class="s2">&quot;intranet.middleware.traceback.UserTracebackMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Include user in traceback</span>
    <span class="s2">&quot;django.contrib.messages.middleware.MessageMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Messages</span>
    <span class="s2">&quot;django_user_agents.middleware.UserAgentMiddleware&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.middleware.session_management.SessionManagementMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Handles session management (might log the user out, so must be early)</span>
    <span class="s2">&quot;intranet.middleware.ajax.AjaxNotAuthenticatedMiddleWare&quot;</span><span class="p">,</span>  <span class="c1"># See note in ajax.py</span>
    <span class="s2">&quot;intranet.middleware.templates.AdminSelectizeLoadingIndicatorMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Selectize fixes</span>
    <span class="s2">&quot;intranet.middleware.templates.NoReferrerMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Prevent malicious JS from changing the referring page</span>
    <span class="s2">&quot;intranet.middleware.access_log.AccessLogMiddleWare&quot;</span><span class="p">,</span>  <span class="c1"># Access log</span>
    <span class="s2">&quot;django_requestlogging.middleware.LogSetupMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Request logging</span>
    <span class="s2">&quot;corsheaders.middleware.CorsMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># CORS headers, for ext. API use</span>
    <span class="s2">&quot;simple_history.middleware.HistoryRequestMiddleware&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django_prometheus.middleware.PrometheusAfterMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Django Prometheus after</span>
    <span class="s2">&quot;intranet.middleware.dark_mode.DarkModeMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Dark mode-related middleware</span>
    <span class="s2">&quot;django_referrer_policy.middleware.ReferrerPolicyMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Sets the Referrer-Policy header</span>
<span class="p">]</span>

<span class="c1"># URLconf at urls.py</span>
<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s2">&quot;intranet.urls&quot;</span>

<span class="c1"># Python dotted path to the WSGI application used by Django&#39;s runserver.</span>
<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s2">&quot;intranet.wsgi.application&quot;</span>

<span class="c1"># Name of current virtualenv</span>
<span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;VIRTUAL_ENV&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="s2">&quot;VIRTUAL_ENV&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>


<div class="viewcode-block" id="get_month_seconds"><a class="viewcode-back" href="../../sourcedoc/intranet.settings.html#intranet.settings.get_month_seconds">[docs]</a><span class="k">def</span> <span class="nf">get_month_seconds</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">30</span></div>


<span class="n">CACHE_AGE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dn_id_mapping&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">get_month_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;user_grade&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">get_month_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;user_classes&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">get_month_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;user_photo&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">get_month_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;class_teacher&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">get_month_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;class_attribute&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">get_month_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;user_attribute&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">get_month_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;bell_schedule&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;users_list&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;printers_list&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;emerg&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()),</span>
    <span class="s2">&quot;sports_school_events&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()),</span>
<span class="p">}</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">PRODUCTION</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SHORT_CACHE&quot;</span><span class="p">,</span> <span class="s2">&quot;NO&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">:</span>
    <span class="c1"># Make the cache age last just long enough to reload the page to</span>
    <span class="c1"># check if caching worked</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">CACHE_AGE</span><span class="p">:</span>
        <span class="n">CACHE_AGE</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># Cacheops configuration</span>
<span class="c1"># may be removed in the future</span>
<span class="n">CACHEOPS_REDIS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">6379</span><span class="p">,</span> <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;socket_timeout&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="n">CACHEOPS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;eighth.*&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())},</span>  <span class="c1"># Only used for caching activity, block lists</span>
    <span class="s2">&quot;groups.*&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())},</span>  <span class="c1"># Only used for caching group list</span>
    <span class="s2">&quot;users.UserDarkModeProperties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ops&quot;</span><span class="p">:</span> <span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())},</span>
    <span class="s2">&quot;features.FeatureAnnouncement&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ops&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())},</span>
    <span class="s2">&quot;*.*&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ops&quot;</span><span class="p">:</span> <span class="p">(),</span> <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>  <span class="c1"># Allow manual caching on everything else with a default timeout of 5 seconds</span>
<span class="p">}</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">TESTING</span><span class="p">:</span>
    <span class="c1"># Settings for django-redis-sessions</span>

    <span class="c1"># We use a custom &quot;wrapper&quot; session engine that inherits from django-redis-session&#39;s session engine.</span>
    <span class="c1"># It allows customization of certain session-related behavior. See the comments in intranet/utils/session.py for more details.</span>
    <span class="n">SESSION_ENGINE</span> <span class="o">=</span> <span class="s2">&quot;intranet.utils.session&quot;</span>

    <span class="n">SESSION_REDIS_HOST</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
    <span class="n">SESSION_REDIS_PORT</span> <span class="o">=</span> <span class="mi">6379</span>
    <span class="n">SESSION_REDIS_DB</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SESSION_REDIS_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;ion:session&quot;</span>
    <span class="n">SESSION_REDIS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">SESSION_REDIS_HOST</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">SESSION_REDIS_PORT</span><span class="p">,</span> <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="n">SESSION_REDIS_DB</span><span class="p">,</span> <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="n">SESSION_REDIS_PREFIX</span><span class="p">}</span>

    <span class="n">SESSION_COOKIE_AGE</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
    <span class="n">SESSION_SAVE_EVERY_REQUEST</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># Avoid conflict between production and testing redis db</span>
            <span class="s2">&quot;DB&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">PRODUCTION</span> <span class="k">else</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>  <span class="c1"># type: Dict[str,Dict[str,Any]]</span>

<span class="k">if</span> <span class="n">TESTING</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DUMMY_CACHE&quot;</span><span class="p">,</span> <span class="s2">&quot;NO&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span> <span class="ow">or</span> <span class="n">NO_CACHE</span><span class="p">:</span>
    <span class="n">CACHES</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;intranet.utils.cache.DummyCache&quot;</span><span class="p">}</span>
    <span class="c1"># extension of django.core.cache.backends.dummy.DummyCache</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">CACHES</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;redis_cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1:6379&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;PARSER_CLASS&quot;</span><span class="p">:</span> <span class="s2">&quot;redis.connection.HiredisParser&quot;</span><span class="p">,</span> <span class="s2">&quot;PICKLE_VERSION&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
        <span class="s2">&quot;KEY_PREFIX&quot;</span><span class="p">:</span> <span class="s2">&quot;ion&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">CSL_REALM</span> <span class="o">=</span> <span class="s2">&quot;CSL.TJHSST.EDU&quot;</span>  <span class="c1"># CSL Realm</span>
<span class="n">AD_REALM</span> <span class="o">=</span> <span class="s2">&quot;LOCAL.TJHSST.EDU&quot;</span>
<span class="n">KINIT_TIMEOUT</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># seconds before pexpect timeouts</span>

<span class="n">FCPS_STUDENT_ID_LENGTH</span> <span class="o">=</span> <span class="mi">7</span>

<span class="c1"># Django REST framework configuration</span>
<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DEFAULT_PERMISSION_CLASSES&quot;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s2">&quot;intranet.apps.auth.rest_permissions.DenyRestrictedPermission&quot;</span><span class="p">,</span>  <span class="c1"># require authentication and deny restricted users</span>
    <span class="p">),</span>
    <span class="s2">&quot;USE_ABSOLUTE_URLS&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="c1"># Return native `Date` and `Time` objects in `serializer.data`</span>
    <span class="s2">&quot;DATETIME_FORMAT&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;DATE_FORMAT&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;TIME_FORMAT&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;EXCEPTION_HANDLER&quot;</span><span class="p">:</span> <span class="s2">&quot;intranet.apps.api.utils.custom_exception_handler&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DEFAULT_PAGINATION_CLASS&quot;</span><span class="p">:</span> <span class="s2">&quot;rest_framework.pagination.PageNumberPagination&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PAGE_SIZE&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s2">&quot;intranet.apps.api.authentication.ApiBasicAuthentication&quot;</span><span class="p">,</span>
        <span class="s2">&quot;intranet.apps.api.authentication.CsrfExemptSessionAuthentication&quot;</span><span class="p">,</span>  <span class="c1"># exempts CSRF checking on API</span>
        <span class="s2">&quot;oauth2_provider.contrib.rest_framework.OAuth2Authentication&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Django OAuth Toolkit configuration</span>
<span class="n">OAUTH2_PROVIDER</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># this disables OIDC</span>
    <span class="s2">&quot;OIDC_ENABLED&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># this is the list of available scopes</span>
    <span class="s2">&quot;SCOPES&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;read&quot;</span><span class="p">:</span> <span class="s2">&quot;Read scope&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">:</span> <span class="s2">&quot;Write scope&quot;</span><span class="p">},</span>
    <span class="c1"># OAuth refresh tokens expire in 30 days</span>
    <span class="s2">&quot;REFRESH_TOKEN_EXPIRE_SECONDS&quot;</span><span class="p">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;PKCE_REQUIRED&quot;</span><span class="p">:</span> <span class="kc">False</span>
<span class="p">}</span>
<span class="n">OAUTH2_PROVIDER_APPLICATION_MODEL</span> <span class="o">=</span> <span class="s2">&quot;oauth.CSLApplication&quot;</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># internal Django</span>
    <span class="s2">&quot;django.contrib.auth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.admindocs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.contenttypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.sessions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.sites&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.messages&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.staticfiles&quot;</span><span class="p">,</span>
    <span class="c1"># Django plugins</span>
    <span class="s2">&quot;django_extensions&quot;</span><span class="p">,</span>  <span class="c1"># django-extensions</span>
    <span class="s2">&quot;django_requestlogging&quot;</span><span class="p">,</span>  <span class="c1"># django-requestlogging-redux</span>
    <span class="s2">&quot;rest_framework&quot;</span><span class="p">,</span>  <span class="c1"># django-rest-framework</span>
    <span class="s2">&quot;maintenance_mode&quot;</span><span class="p">,</span>  <span class="c1"># django-maintenance-mode</span>
    <span class="s2">&quot;django_prometheus&quot;</span><span class="p">,</span>  <span class="c1"># django-prometheus</span>
    <span class="s2">&quot;pipeline&quot;</span><span class="p">,</span>  <span class="c1"># django-pipeline</span>
    <span class="s2">&quot;channels&quot;</span><span class="p">,</span>
    <span class="c1"># Intranet apps</span>
    <span class="s2">&quot;intranet.apps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.announcements&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.api&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.auth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.bus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.cslapps&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.eighth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.events&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.groups&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.search&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.schedule&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.notifications&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.feedback&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.users&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.preferences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.files&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.printing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.polls&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.signage&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.seniors&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.emerg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.itemreg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.lostfound&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.emailfwd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.parking&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.dataimport&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.nomination&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.sessionmgmt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.features&quot;</span><span class="p">,</span>
    <span class="s2">&quot;intranet.apps.oauth&quot;</span><span class="p">,</span>
    <span class="c1"># Django plugins</span>
    <span class="s2">&quot;widget_tweaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;oauth2_provider&quot;</span><span class="p">,</span>  <span class="c1"># django-oauth-toolkit</span>
    <span class="s2">&quot;corsheaders&quot;</span><span class="p">,</span>  <span class="c1"># django-cors-headers</span>
    <span class="s2">&quot;cacheops&quot;</span><span class="p">,</span>  <span class="c1"># django-cacheops</span>
    <span class="s2">&quot;svg&quot;</span><span class="p">,</span>  <span class="c1"># django-inline-svg</span>
    <span class="s2">&quot;simple_history&quot;</span><span class="p">,</span>  <span class="c1"># django-simple-history</span>
    <span class="s2">&quot;django_referrer_policy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django_user_agents&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Django Channels Configuration (we use this for websockets)</span>
<span class="n">CHANNEL_LAYERS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;channels_redis.core.RedisChannelLayer&quot;</span><span class="p">,</span> <span class="s2">&quot;CONFIG&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;hosts&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">)]}}}</span>

<span class="n">ASGI_APPLICATION</span> <span class="o">=</span> <span class="s2">&quot;intranet.routing.application&quot;</span>

<span class="n">PROMETHEUS_EXPORT_MIGRATIONS</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Eighth period default block date format</span>
<span class="c1"># Post Django 1.8.7, this can no longer be used in templates.</span>
<span class="n">EIGHTH_BLOCK_DATE_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;D, N j, Y&quot;</span>

<span class="c1"># See http://docs.djangoproject.com/en/dev/topics/logging for</span>
<span class="c1"># more details on how to customize your logging configuration.</span>
<span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span> <span class="k">if</span> <span class="n">LOGGING_VERBOSE</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;LOG_LEVEL&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">):</span>
    <span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOG_LEVEL&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="get_log"><a class="viewcode-back" href="../../sourcedoc/intranet.settings.html#intranet.settings.get_log">[docs]</a><span class="k">def</span> <span class="nf">get_log</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>  <span class="c1"># pylint: disable=redefined-outer-name; &#39;name&#39; is used as the target of a for loop, so we can safely override it</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">PRODUCTION</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">IN_CI</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]</span></div>


<span class="c1"># https://docs.djangoproject.com/en/dev/topics/logging/</span>
<span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;disable_existing_loggers&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;formatters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;simple&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(remote_addr)s</span><span class="s2"> - </span><span class="si">%(username)s</span><span class="s2"> - </span><span class="si">%(path_info)s</span><span class="se">\n\t</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">},</span>
        <span class="s2">&quot;access&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">},</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2">: </span><span class="se">\n</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;require_debug_false&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;()&quot;</span><span class="p">:</span> <span class="s2">&quot;django.utils.log.RequireDebugFalse&quot;</span><span class="p">},</span>
        <span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;()&quot;</span><span class="p">:</span> <span class="s2">&quot;django_requestlogging.logging_filters.RequestFilter&quot;</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># Log in console</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.StreamHandler&quot;</span><span class="p">,</span> <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">],</span> <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;simple&quot;</span><span class="p">},</span>
        <span class="c1"># Log access in console</span>
        <span class="s2">&quot;console_access&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.StreamHandler&quot;</span><span class="p">,</span> <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">],</span> <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;access&quot;</span><span class="p">},</span>
        <span class="c1"># Log access to file (DEBUG=FALSE)</span>
        <span class="s2">&quot;access_log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;require_debug_false&quot;</span><span class="p">],</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.handlers.TimedRotatingFileHandler&quot;</span><span class="p">,</span>
            <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;access&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/log/ion/app_access.log&quot;</span><span class="p">,</span>
            <span class="c1"># Rollover on Sundays; preserve 20 weeks</span>
            <span class="s2">&quot;when&quot;</span><span class="p">:</span> <span class="s2">&quot;W6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;backupCount&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s2">&quot;delay&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="c1"># Log auth to file (DEBUG=FALSE)</span>
        <span class="s2">&quot;auth_log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;require_debug_false&quot;</span><span class="p">],</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.handlers.TimedRotatingFileHandler&quot;</span><span class="p">,</span>
            <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;access&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/log/ion/app_auth.log&quot;</span><span class="p">,</span>
            <span class="c1"># Rollover on Sundays; preserve 20 weeks</span>
            <span class="s2">&quot;when&quot;</span><span class="p">:</span> <span class="s2">&quot;W6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;backupCount&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s2">&quot;delay&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="c1"># Log error to file (DEBUG=FALSE)</span>
        <span class="s2">&quot;error_log&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;require_debug_false&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">],</span>
            <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;logging.FileHandler&quot;</span><span class="p">,</span>
            <span class="s2">&quot;formatter&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/log/ion/app_error.log&quot;</span><span class="p">,</span>
            <span class="s2">&quot;delay&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;loggers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># Django errors get sent to console and error logfile</span>
        <span class="s2">&quot;django&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;console&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">get_log</span><span class="p">(</span><span class="s2">&quot;error_log&quot;</span><span class="p">),</span> <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="c1"># Intranet errors go to console and error logfile</span>
        <span class="s2">&quot;intranet&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;console&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">get_log</span><span class="p">(</span><span class="s2">&quot;error_log&quot;</span><span class="p">),</span> <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">LOG_LEVEL</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="c1"># Intranet access logs to accesslog</span>
        <span class="s2">&quot;intranet_access&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;console_access&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">get_log</span><span class="p">(</span><span class="s2">&quot;access_log&quot;</span><span class="p">),</span> <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="c1"># Intranet auth logs to authlog</span>
        <span class="s2">&quot;intranet_auth&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;console_access&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">get_log</span><span class="p">(</span><span class="s2">&quot;auth_log&quot;</span><span class="p">),</span> <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="c1"># errors that relate to sentry</span>
        <span class="s2">&quot;sentry.errors&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;console&quot;</span><span class="p">],</span> <span class="s2">&quot;propagate&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="c1"># The debug toolbar is always loaded, unless you manually override SHOW_DEBUG_TOOLBAR</span>
<span class="n">SHOW_DEBUG_TOOLBAR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SHOW_DEBUG_TOOLBAR&quot;</span><span class="p">,</span> <span class="s2">&quot;YES&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span>

<span class="k">if</span> <span class="n">SHOW_DEBUG_TOOLBAR</span><span class="p">:</span>
    <span class="n">DEBUG_TOOLBAR_PATCH_SETTINGS</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Boolean value defines whether enabled by default</span>
    <span class="n">_panels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.versions.VersionsPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.timer.TimerPanel&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.settings.SettingsPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.headers.HeadersPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.request.RequestPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.sql.SQLPanel&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.staticfiles.StaticFilesPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.templates.TemplatesPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.cache.CachePanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.signals.SignalsPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.logging.LoggingPanel&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.redirects.RedirectsPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;debug_toolbar.panels.profiling.ProfilingPanel&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="c1"># Only show debug toolbar when requested if in production.</span>
    <span class="n">DEBUG_TOOLBAR_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;DISABLE_PANELS&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">panel</span> <span class="k">for</span> <span class="n">panel</span><span class="p">,</span> <span class="n">enabled</span> <span class="ow">in</span> <span class="n">_panels</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled</span><span class="p">],</span>
        <span class="s2">&quot;SHOW_TOOLBAR_CALLBACK&quot;</span><span class="p">:</span> <span class="s2">&quot;intranet.utils.helpers.debug_toolbar_callback&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">DEBUG_TOOLBAR_PANELS</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_panels</span><span class="p">]</span>

    <span class="c1"># Add middleware</span>
    <span class="n">MIDDLEWARE</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="s2">&quot;intranet.middleware.templates.StripNewlinesMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Strip newlines</span>
            <span class="s2">&quot;debug_toolbar.middleware.DebugToolbarMiddleware&quot;</span><span class="p">,</span>  <span class="c1"># Debug toolbar</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">INSTALLED_APPS</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;debug_toolbar&quot;</span><span class="p">]</span>

<span class="n">MAINTENANCE_MODE_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;error/503.html&quot;</span>
<span class="n">MAINTENANCE_MODE_IGNORE_SUPERUSER</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Allow *.tjhsst.edu sites to access API, signage, and other resources</span>
<span class="n">CORS_ALLOW_ALL_ORIGINS</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Uncomment to only allow XHR on API resources from TJ domains</span>
<span class="c1"># CORS_URLS_REGEX = r&#39;^/api/.*$&#39;</span>

<span class="c1"># Same origin frame options</span>
<span class="n">X_FRAME_OPTIONS</span> <span class="o">=</span> <span class="s2">&quot;SAMEORIGIN&quot;</span>

<span class="c1"># X-XSS-Protection: 1; mode=block</span>
<span class="c1"># Already set on nginx level</span>
<span class="n">SECURE_BROWSER_XSS_FILTER</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># To accomodate for the fact that nginx &quot;swallows&quot; https connections</span>
<span class="c1"># by forwarding to http://gunicorn</span>
<span class="c1"># https://docs.djangoproject.com/en/dev/ref/settings/#secure-proxy-ssl-header</span>
<span class="n">SECURE_PROXY_SSL_HEADER</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;HTTP_X_FORWARDED_PROTO&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">)</span>

<span class="c1"># Add git information for the login page</span>
<span class="n">GIT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;commit_short_hash&quot;</span><span class="p">:</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_current_commit_short_hash</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">),</span>
    <span class="s2">&quot;commit_long_hash&quot;</span><span class="p">:</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_current_commit_long_hash</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">),</span>
    <span class="s2">&quot;commit_info&quot;</span><span class="p">:</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_current_commit_info</span><span class="p">(),</span>
    <span class="s2">&quot;commit_date&quot;</span><span class="p">:</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_current_commit_date</span><span class="p">(),</span>
    <span class="s2">&quot;commit_github_url&quot;</span><span class="p">:</span> <span class="n">helpers</span><span class="o">.</span><span class="n">get_current_commit_github_url</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Senior graduation date.</span>
<span class="c1"># The year will be replaced as appropriate (determined in</span>
<span class="c1"># intranet/utils/date.py based on YEAR_TURNOVER_MONTH).</span>
<span class="n">SENIOR_GRADUATION_YEAR</span> <span class="o">=</span> <span class="n">end_school_year</span>
<span class="n">SENIOR_GRADUATION_DATE</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">SENIOR_GRADUATION_YEAR</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">SENIOR_GRADUATION</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">SENIOR_GRADUATION_YEAR</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%B </span><span class="si">%d</span><span class="s1"> %Y %H:%M:%S&#39;</span><span class="p">)</span>

<span class="c1"># The number of days out at which a user is deemed &quot;near graduation&quot;.</span>
<span class="n">NEAR_GRADUATION_DAYS</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># The hour on an eighth period day to lock teachers from</span>
<span class="c1"># taking attendance (10PM)</span>
<span class="n">ATTENDANCE_LOCK_HOUR</span> <span class="o">=</span> <span class="mi">22</span>

<span class="c1"># The number of days to show an absence message (2 weeks)</span>
<span class="n">CLEAR_ABSENCE_DAYS</span> <span class="o">=</span> <span class="mi">14</span>

<span class="c1"># The address for FCPS&#39; Emergency Announcement page</span>
<span class="n">FCPS_EMERGENCY_PAGE</span> <span class="o">=</span> <span class="s2">&quot;https://www.fcps.edu/alert_msg_feed&quot;</span>  <span class="c1"># type: str</span>

<span class="c1"># The timeout for the request to FCPS&#39; emergency page (in seconds)</span>
<span class="n">EMERGENCY_TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">CSL_STATUS_PAGE</span> <span class="o">=</span> <span class="s2">&quot;https://status.tjhsst.edu/index.json&quot;</span>

<span class="c1"># How frequently the emergency announcement cache should be updated by the Celerybeat task.</span>
<span class="c1"># This should be less than CACHE_AGE[&quot;emerg&quot;].</span>
<span class="n">FCPS_EMERGENCY_CACHE_UPDATE_INTERVAL</span> <span class="o">=</span> <span class="n">CACHE_AGE</span><span class="p">[</span><span class="s2">&quot;emerg&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">30</span>

<span class="c1"># Show an iframe with tjStar activity data</span>
<span class="k">if</span> <span class="n">TJSTAR_MAP</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">TJSTAR_MAP</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">SIMILAR_THRESHOLD</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># Time that the bus page should change from morning to afternoon display</span>
<span class="n">BUS_PAGE_CHANGEOVER_HOUR</span> <span class="o">=</span> <span class="mi">12</span>

<span class="c1"># Substrings of user agents to not log in the Ion access logs</span>
<span class="n">NONLOGGABLE_USER_AGENT_SUBSTRINGS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Prometheus&quot;</span><span class="p">,</span> <span class="s2">&quot;GoogleBot&quot;</span><span class="p">,</span> <span class="s2">&quot;UptimeRobot&quot;</span><span class="p">]</span>

<span class="c1"># The location of the Celery broker (message transport)</span>
<span class="n">CELERY_BROKER_URL</span> <span class="o">=</span> <span class="s2">&quot;amqp://localhost&quot;</span>

<span class="n">CELERY_ACCEPT_CONTENT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;pickle&quot;</span><span class="p">]</span>
<span class="n">CELERY_TASK_SERIALIZER</span> <span class="o">=</span> <span class="s2">&quot;pickle&quot;</span>

<span class="n">CELERY_BEAT_SCHEDULE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;update-fcps-emergency-cache&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;intranet.apps.emerg.tasks.update_emerg_cache_task&quot;</span><span class="p">,</span>
        <span class="s2">&quot;schedule&quot;</span><span class="p">:</span> <span class="n">FCPS_EMERGENCY_CACHE_UPDATE_INTERVAL</span><span class="p">,</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="p">},</span>
    <span class="s2">&quot;reset-routes-afternoon&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;intranet.apps.bus.tasks.reset_routes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;schedule&quot;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">crontab</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="p">},</span>
    <span class="s2">&quot;reset-routes-morning&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;intranet.apps.bus.tasks.reset_routes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;schedule&quot;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">crontab</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="n">BUS_PAGE_CHANGEOVER_HOUR</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="p">},</span>
    <span class="s2">&quot;pull-sports-schedule&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;intranet.apps.events.tasks.pull_sports_schedules&quot;</span><span class="p">,</span>
        <span class="s2">&quot;schedule&quot;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">crontab</span><span class="p">(</span><span class="n">day_of_month</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="p">},</span>
    <span class="s2">&quot;follow-up-absence-emails&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;intranet.apps.eighth.tasks.follow_up_absence_emails&quot;</span><span class="p">,</span>
        <span class="s2">&quot;schedule&quot;</span><span class="p">:</span> <span class="n">celery</span><span class="o">.</span><span class="n">schedules</span><span class="o">.</span><span class="n">crontab</span><span class="p">(</span><span class="n">day_of_month</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">MAINTENANCE_MODE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Django User Agents configuration</span>
<span class="n">USER_AGENTS_CACHE</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

<span class="c1"># The Referrer-policy header</span>
<span class="n">REFERRER_POLICY</span> <span class="o">=</span> <span class="s2">&quot;strict-origin-when-cross-origin&quot;</span>

<span class="n">REAUTHENTICATION_EXPIRE_TIMEOUT</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># seconds</span>

<span class="n">EIGHTH_COORDINATOR_NAME</span> <span class="o">=</span> <span class="s2">&quot;Laura Slonina&quot;</span>

<span class="c1"># Script provided to assist in importing users to BbCU</span>
<span class="n">BBCU_SCRIPT</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Enable hybrid eighth period code</span>
<span class="n">ENABLE_HYBRID_EIGHTH</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># How often the signage JS sends a heartbeat</span>
<span class="n">SIGNAGE_HEARTBEAT_INTERVAL</span> <span class="o">=</span> <span class="mi">60</span>
<span class="c1"># No heartbeat after this many seconds means a sign will be considered offline</span>
<span class="n">SIGNAGE_HEARTBEAT_OFFLINE_TIMEOUT_SECS</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">60</span>

<span class="c1"># Shows a warning message with yellow background on the login page</span>
<span class="c1"># LOGIN_WARNING = &quot;This is a message to display on the login page.&quot;</span>

<span class="c1"># Shows a warning message with yellow background on the login and all interior pages</span>
<span class="c1"># GLOBAL_WARNING = &quot;This is a message to display throughout the application.&quot;</span>

<span class="n">DEFAULT_AUTO_FIELD</span> <span class="o">=</span> <span class="s2">&quot;django.db.models.AutoField&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.secret</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># noqa</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1"># In-memory sqlite3 databases significantly speed up running tests.</span>
<span class="k">if</span> <span class="n">TESTING</span><span class="p">:</span>
    <span class="n">DATABASES</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">][</span><span class="s2">&quot;ENGINE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;django.db.backends.sqlite3&quot;</span>
    <span class="n">DATABASES</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">][</span><span class="s2">&quot;NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;:memory:&quot;</span>
    <span class="c1"># Horrible hack to suppress all migrations to speed up the tests.</span>
    <span class="n">MIGRATION_MODULES</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">MigrationMock</span><span class="p">()</span>
    <span class="c1"># FIXME: we really shouldn&#39;t have to do this.</span>
    <span class="n">LOGGING_VERBOSE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;-v ?[2-3]|--verbosity [2-3]&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="k">elif</span> <span class="n">PRODUCTION</span> <span class="ow">or</span> <span class="n">SECRET_DATABASE_URL</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">DATABASES</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">helpers</span><span class="o">.</span><span class="n">parse_db_url</span><span class="p">(</span><span class="n">SECRET_DATABASE_URL</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Default testing db config.</span>
    <span class="n">DATABASES</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;ion&quot;</span><span class="p">,</span> <span class="s2">&quot;USER&quot;</span><span class="p">:</span> <span class="s2">&quot;ion&quot;</span><span class="p">,</span> <span class="s2">&quot;PASSWORD&quot;</span><span class="p">:</span> <span class="s2">&quot;pwd&quot;</span><span class="p">})</span>

<span class="c1"># Set up sentry logging</span>
<span class="k">if</span> <span class="n">PRODUCTION</span><span class="p">:</span>
    <span class="c1"># This is implicitly set up but we do this just in case</span>
    <span class="n">sentry_logging</span> <span class="o">=</span> <span class="n">LoggingIntegration</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">event_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span>  <span class="c1"># Capture info and above as breadcrumbs  # Send errors as events</span>
    <span class="p">)</span>
    <span class="n">sentry_sdk</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">SENTRY_PUBLIC_DSN</span><span class="p">,</span> <span class="n">integrations</span><span class="o">=</span><span class="p">[</span><span class="n">DjangoIntegration</span><span class="p">(),</span> <span class="n">sentry_logging</span><span class="p">,</span> <span class="n">CeleryIntegration</span><span class="p">()],</span> <span class="n">send_default_pii</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2022, TJ Intranet Development Team.<br/>
    </p>
  </div>
</footer>
  </body>
</html>