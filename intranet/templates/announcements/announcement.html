{% load dates %}
<div class="announcement{% if hide_announcements and announcement in user_hidden_announcements %} hidden{% endif %}" data-id="{{ announcement.id }}" id="announcement-{{ announcement.id }}">
    <h3>
        {% if link_to_announcement %}
        <a href="{% url 'view_announcement' announcement.id %}" class="announcement-link">
            {{ announcement.title }}
        </a>
        {% else %}
            {{ announcement.title }}
        {% endif %}

            <div class="announcement-icon-wrapper">
            {% if hide_announcements %}
                <a href="#" class="announcement-toggle">
                {% if announcement in user_hidden_announcements %}
                    <i class="announcement-icon fa fa-toggle-off" title="You have hidden this announcement." data-visible-title="This announcement is visible." hidden-title="You have hidden this announcement."></i>
                {% else %}
                    <i class="announcement-icon fa fa-toggle-on" title="This announcement is visible." data-visible-title="This announcement is visible." data-hidden-title="You have hidden this announcement."></i>
                {% endif %}
                </a>
            {% endif %}
            {% if request.user.is_announcements_admin %}
                <a href="{% url 'modify_announcement' announcement.id %}">
                    <i class="announcement-icon fa fa-pencil"></i>
                </a>
                <a href="{% url 'delete_announcement' announcement.id %}" class="announcement-delete">
                    <i class="announcement-icon fa fa-trash-o"></i>
                </a>
            {% endif %}
            </div>
    </h3>

    <div class="announcement-metadata">
        by {{ announcement.get_author|escape }} &bull; {{ announcement.updated|fuzzy_date|capfirst }} &bull; to
        {% for group in announcement.groups.all %}
            {{ group }}
            {% if not forloop.last %},{% endif %}
        {% empty %}
            everyone
        {% endfor %}
    </div>

    <div class="announcement-toggle-content">
        {% if announcement.event_set.count > 0 and not event %}
            {% for event in announcement.event_set.all %}
                {% with link_to_event=1 %}
                    {% include "events/event.html" %}
                {% endwith %}
            {% endfor %}
        {% endif %}

        <div class="announcement-content">
            {{ announcement.content|safe }}
        </div>
    </div>
</div>