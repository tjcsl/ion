<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Understanding the Eighth models &#8212; TJ Intranet v3 (Build #2619) documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to do Ion development" href="howto.html" />
    <link rel="prev" title="Developing for Intranet" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          TJ Intranet</a>
        <span class="navbar-text navbar-version pull-left"><b>v3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Topics <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../setup/server.html">Setting up the Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../architecture/index.html#technologies">Technologies</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developing for Intranet</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Understanding the Eighth models</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto.html">How to do Ion development</a></li>
<li class="toctree-l2"><a class="reference internal" href="oauth.html">Using OAuth</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html">Ion Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="styleguide.html">Coding Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing Ion</a></li>
<li class="toctree-l2"><a class="reference internal" href="updates.html">Keeping things up-to-date</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sourcedoc/modules.html">intranet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sourcedoc/intranet.html">intranet package</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Section <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Understanding the Eighth models</a><ul>
<li><a class="reference internal" href="#more-details-on-eighthactivity-and-eighthscheduledactivity">More details on <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code> and <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code></a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="understanding-the-eighth-models">
<h1>Understanding the Eighth models<a class="headerlink" href="#understanding-the-eighth-models" title="Permalink to this heading">¶</a></h1>
<p>Most of Ion’s apps either do not have models or only have very basic models. The <code class="docutils literal notranslate"><span class="pre">eighth</span></code> app, however, has a complicated system of models.</p>
<p>What follows is a brief list of the eighth models with a description of each. More information is available in comments of the source code.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">EighthSponsor</span></code>: Represents a sponsor for an eighth period activity. Stores some information on the sponsor, including first/last name and department name. The <code class="docutils literal notranslate"><span class="pre">user</span></code> field that associates the <code class="docutils literal notranslate"><span class="pre">EighthSponsor</span></code> with a <code class="docutils literal notranslate"><span class="pre">User</span></code> is optional, but almost always set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EighthRoom</span></code>: Represents a room in which an eighth period activity can be held. Stores the name, the capacity, and whether the room is available for use in eighth period activities. If the capacity is -1, that is considered to be infinite capacity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code>: Represents an eighth period activity. Note that this represents an activity, not a specific scheduling of the activity. In other words, only one of these exists for each club/team/special activity.</p>
<p>In addition to the name and the description, this stores a lot of information about the activity that will be explained later.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">EighthBlock</span></code>: Represents an eighth period block. Stores the date, the time to sign up by, the “letter” of the block, whether the block is locked, and some other miscellaneous information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code>: Represents a scheduling of an eighth period activity during a particular block. Has <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>s to the the <code class="docutils literal notranslate"><span class="pre">EighthBlock</span></code> and the <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code> that it is associated with, and keeps track of whether it has been cancelled and whether it has had its attendance taken. As with <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code>, this will be explained in more detail later.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">add_user()</span></code> method of this class is where all of the logic to sign a user up for an activity is. Be <em>very</em> careful when modifying it.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">EighthSignup</span></code>: Represents that a user is signed up for a particular <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code> during the block for which it is scheduled. Has <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code>s to the <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code> and the <code class="docutils literal notranslate"><span class="pre">User</span></code> objects. Also stores some information such as whether the user signed up after the deadline (assumed to be a pass), whether the user signed themselves up or was signed up by an eighth admin, the name and sponsor list of the activity they were signed up for previously (if applicable), whether they were absent, etc.</p>
<p><strong>Note</strong>: Since Ion’s launch, it has been plagued by duplicate <code class="docutils literal notranslate"><span class="pre">EighthSignup</span></code>s (<code class="docutils literal notranslate"><span class="pre">EighthSignup</span></code>s for the same user during the same block) being created. There are multiple checks before the object is saved to make sure it is unique, and uniqueness is enforced on a per-user, per- <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code> basis at the model level, but the problem has continued. As of summer 2019, measures have been enacted that will hopefully minimize the occurrences of this issue in the future, as well as allow better diagnosing of the problem if it occurs again.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">EighthWaitlist</span></code>: Ion has all of the backend logic to implement waitlists for each activity, but it is not enabled in production (<code class="docutils literal notranslate"><span class="pre">settings.ENABLE_WAITLIST</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>). When the waitlist is enabled, an <code class="docutils literal notranslate"><span class="pre">EighthWaitlist</span></code> object represents that a user signed up for the waitlist for a particular <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code> at a particular time. The user’s position in the waitlist is calculated dynamically by finding the number of users who signed up for the waitlist before them.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EighthActivitySimilarity</span></code>: Keeps track of the similarity index of two activities, based on which users attend which activities. Used to recommend activities.</p></li>
</ul>
<section id="more-details-on-eighthactivity-and-eighthscheduledactivity">
<h2>More details on <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code> and <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code><a class="headerlink" href="#more-details-on-eighthactivity-and-eighthscheduledactivity" title="Permalink to this heading">¶</a></h2>
<p>There are a number of fields (the sponsor list, the room list, the activity capacity, whether the activity runs both blocks, whether it is restricted, etc.) that are usually the same for all schedulings of an <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code>, but sometimes change on a per-activity basis. Hence, both <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code> and <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code> have fields that record this information, and <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code> has helper methods that check both fields to determine the “real” value.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">BooleanField</span></code>s, this is simple: if either of the <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code>’s field and the <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code>’s field is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the activity is considered to have that property. For the room list and the sponsor list, the <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code>’s list is used if it has at least one room/sponsor; otherwise, the <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code>’s list is used.</p>
<p>In addition, the capacity has multiple overrides:</p>
<ul class="simple">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code> has the <code class="docutils literal notranslate"><span class="pre">capacity</span></code> field set, it is used.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">EighthScheduledActivity</span></code> has at least one room, the sum of all of their capacities is used.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code> has the <code class="docutils literal notranslate"><span class="pre">default_capacity</span></code> field set, it is used.</p></li>
<li><p>Finally, the sum of all of the capacities of the <code class="docutils literal notranslate"><span class="pre">EighthActivity</span></code>’s rooms is used.</p></li>
</ul>
<p>Note that if the capacity is -1, it denotes unrestricted capacity. If the capacity calculation ends up using the sum of the capacities of a set of rooms and one of the room’s capacities is -1, the activity’s capacity will also be -1.</p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2024, TJ Intranet Development Team.<br/>
    </p>
  </div>
</footer>
  </body>
</html>